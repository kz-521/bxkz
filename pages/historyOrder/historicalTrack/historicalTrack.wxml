<wxs module="utilTool" src="../../../utils/tool.wxs"></wxs>

<view class="historical-track">
  <map id='historyMap' 
  style="height:740rpx"
  scale="{{scale}}" 
  subkey="{{subkey}}" 
  longitude='{{longitude}}' 
  latitude='{{latitude}}' 
  polyline="{{polyline}}" 
  markers="{{markers}}" 
  polygons="{{polygons}}"
  circles="{{circles}}">
  </map>
  <view class="card">
    <view class="card-item">
      <view style="justify-content: space-between;box-sizing:border-box; padding: 20rpx 40rpx 20rpx 40rpx;border-bottom:2rpx solid #f6f6f6">
        <view style="color: #000;">{{item.startTime}}</view>
        <view wx:if="{{!isBicycle}}" style="font-size: 26rpx;">车辆编号:{{item.userCode}}</view>
        <view wx:else style="font-size: 26rpx;">NO.{{utilTool.deleteFirstString(item.userCode)}}</view>
      </view>
      <view wx:if="{{ isPay }}" style="justify-content: space-around;padding: 10rpx 0 10rpx 0;height:144rpx">
        <view>
          <view><text>{{item.time}}</text> 分钟</view>
          <view style="text-align: center">骑行时长</view>
        </view>
        <view>
          <view><text>{{item.mileage}}</text> 公里</view>
          <view style="text-align: center">骑行距离</view>
        </view>
        <view catchtap="showRule"> <!--电动车模式-->
          <view>
            <text>{{money  || 0}}</text> 元 
            <image style="width:25rpx;height:25rpx;" src="../../../images/map/query.png" catchtap="showRule"></image>
          </view>
          <view style="text-align: center">总费用</view>
        </view>
      </view>
      <!-- 待支付 -->
      <view wx:if="{{(noPay || hadPay) && noPayHistory}}" class="no_pay_top">
        <view style="font-size:28rpx;font-weight:700;color:#333333">
        您有一笔未支付订单，完成支付后可继续用车
        </view>
        <view style="margin-top:10rpx;">
        <image src="../../../images/map/kefu@3x.png" style="width:44rpx;height:46rpx;" catchtap="toHelp"></image>
        </view>
      </view>
      <view wx:if="{{isPay}}" class="is_pay">
      <view>
        <view style="font-size:32rpx;"> 费用明细: </view>
      </view>
       <view>
        <view class="bottom">
          <view class="bottom_item padding color999"><view>骑行费</view><view>{{ridingPay}}元</view></view>
          <view class="bottom_item padding color999"><view> 调度费</view><view>{{transfer}}元</view></view>
          <view class="bottom_item padding color999"><view>余额支付</view><view>{{item.money / 100}}元</view></view>
          <view class="bottom_item "><view>优惠抵扣</view> 
            <view catchtap="open_detail" style="color:#E44B4B">-{{sale}}元
              <image style="width:28rpx;height:16rpx;margin-left:12rpx; transform:rotate({{show_sale ? '180deg' : '0deg'}})" src="../../../images/zhankai.png"></image>
            </view>
          </view>
          <view wx:if="{{show_sale && tiket}}" class="bottom_item padding" style="color:#E44B4B"><view>优惠卷</view><view>-{{tiket}}元</view></view>
          <!-- <view wx:if="{{show_sale }}" class="bottom_item padding" style="color:red;"><view>骑行卡</view><view>-{{item.money / 100}}元</view></view> -->
          <!-- <view wx:if="{{show_sale && membershipCard}}" class="bottom_item padding" style="color:red;"><view>会员卡</view><view>-{{membershipCard}}元</view></view> -->
          <view wx:if="{{show_sale && gift}}" class="bottom_item padding" style="color:#E44B4B"><view>礼品卡</view><view>-{{gift}}元</view></view>
        </view>
       </view>
      </view>
      <!-- 人工结束 -->
      <view wx:if="{{(!((noPay || hadPay) && noPayHistory)) && !isPay }}">
        <view class="" style="text-align:center;height:450rpx;font-size: 26rpx;color: #666;">
        <view style="box-sizing:border-box;width:752rpx;height:158rpx;display:flex;justify-content:space-between;font-weight:700;padding:0rpx 60rpx 0 60rpx;border-bottom:2rpx solid #f6f6f6">
          <view style="box-sizing:border-box;">
          <view style="font-size:28rpx;color:#666;font-weight:400"><text>{{item.time}}</text> 分钟</view>
          <view style="text-align: center;font-size:28rpx;font-weight:400;color:#666">借车时长</view>
        </view>
        <view style="box-sizing:border-box;">
          <view style="font-size:28rpx;color:#666;font-weight:400"><text>{{item.mileage}}</text> 公里</view>
          <view style="text-align: center;font-size:28rpx;font-weight:400;color:#666">骑行距离</view>
        </view>
        <view catchtap="showRule"> <!--电动车模式-->
          <view style="font-size:28rpx;color:#666;font-weight:400"> 
            <text>{{(item.money / 100 ) || 0}}</text> 元 
            <image style="width:25rpx;height:25rpx;font-size:28rpx" src="../../../images/map/query.png" catchtap="showRule"></image>
          </view>
          <view style="text-align: center;font-size:28rpx;font-weight:400;color:#666">总费用</view>
        </view>
        </view>
        <view style="box-sizing:border-box ;width:752rpx;height:160rpx;align-content:center;justify-content:center;padding:18rpx 60rpx 20rpx 60rpx;color:#333;text-align:left;">
          {{remark  || '空'}}
        </view>
       </view>
       </view>

       <view wx:if="{{(noPay || hadPay) && noPayHistory}}" style="justify-content:cneter;flex-direction:column;align-content:center;align-items:center;padding: 0 0rpx 0 0rpx;width:100%;height:296rpx;">
        <view class="bottom" style="text-align:center">
        <view style="width:751rpx;height:160rpx;align-content:center;justify-content:center;border-bottom:2rpx solid #f6f6f6;color:#333;box-sizing:border-box;padding:0 44rpx 0 42rpx;margin-top:-10rpx;text-align:left;font-size:28rpx">
          {{remark || '空'}}
        </view>
        <view style="height:158rpx;display:flex;flex-direction:row; justify-content:space-between;font-weight:700;margin:20rpx 60rpx 0 60rpx">
          <view style="box-sizing:border-box;">
          <view style="font-size:28rpx;color:#666;font-weight:400"><text>{{item.time}}</text> 分钟</view>
          <view style="text-align: center;font-size:28rpx;font-weight:400">借车时长</view>
        </view>
        <view style="box-sizing:border-box;">
          <view style="font-size:28rpx;color:#666;font-weight:400"><text>{{item.mileage}}</text> 公里</view>
          <view style="text-align: center;font-size:28rpx;font-weight:400">骑行距离</view>
        </view>
        <view catchtap="showRule"> <!--电动车模式-->
          <view style="font-size:28rpx;color:#666;font-weight:400">
            <text style="font-weight:400">{{(item.money / 100 ) || 0}}</text> 元 
            <image style="width:25rpx;height:25rpx;font-size:28rpx" src="../../../images/map/query.png" catchtap="showRule"></image>
          </view>
          <view style="text-align: center;font-size:28rpx;font-weight:400">总费用</view>
        </view>
        </view>
       </view>
       </view>

      <view wx:if="{{!isBicycle}}" style="height:196rpx;box-sizing:border-box; justify-content: space-around;border-top: 1px solid #f6f6f6;padding: 30rpx 20rpx 0rpx 20rpx;box-shadow: 0px -1px 8px -3px #DDDDDD;">     
        <view wx:if="{{isPay | (hadPay && !noPay)}}" class="query" catchtap="activeSheet">对此订单有疑问?</view>
        <view wx:if="{{noPay}}" class="no_pay_query1" catchtap="toPay">去支付</view>
      </view>
    </view>
  </view>

  <view class="zhezao" wx:if="{{faultDialog}}">
    <!-- <view class="zhezao" wx:if="{{true}}"> -->
    <view class="questionnaire">
      <!-- <view class="questionnaire-title">
       <view style="font-size:26rpx;font-weight:600;color:#333">电车还可骑行<text>{{surplusMileage}}</text>公里</view>
        <view style="font-size:26rpx;color:#999;">车辆编号 <text>{{machineNO}}</text></view>
      </view> -->
      <view style="padding: 0 15px 30rpx 0;" class="bottom_box">
        <view style="font-size: 36rpx;font-weight:bold;text-align:center;margin-top:40rpx;color:#F37546">本次订单使用车辆时间较短</view>
        <view style="font-size: 36rpx;font-weight:400;text-align:center;margin:20rpx 0 40rpx 0;color:#333333">车辆是否存在问题？</view>
        <view class="questionnaire-body">
          <view data-item="拧把不走" catchtap="sendReport">
              <button class="no">拧把不走</button>
          </view>
          <view data-item="车辆被破坏" catchtap="sendReport">
            <button class="no">车辆被破坏</button>
          </view>
          <view data-item="刹车失灵" catchtap="sendReport">
              <button class="no">刹车失灵</button>
          </view>
          <view data-item="没有问题" catchtap="sendReport">
                   <button class="no">没有问题</button>
          </view> 
        </view>
        <view class="pink_go" catchtap="sendReport" data-item="其他，详见故障上报" data-jump="toFault">
          问题不被囊括？点击前往故障上报<mp-icon class="pink_right" icon="arrow" color="#FE5252" size="{{14}}"></mp-icon>
        </view>
      </view>
    </view>
  </view>
</view>

<billing ruleShow="{{ruleShow}}"></billing>